<project default="build.requirement">
		  <!--property name="requirement.root" value="C:/Code/jbosside-cvs/jbosside-build/requirements"/-->
	<property file="build.properties"/>
	
	<taskdef classpath="../../lib/ant-contrib.jar" resource="net/sf/antcontrib/antlib.xml"/>

	<target name="build.requirement" depends="download.hibernate,unzip.hibernate,checkout.hibernateext">
		<property name="hibernateext.root" value="${hibernateext.build.dir}/${hibernateext.cvs.module}"/>
		<property name="build.script" value="${hibernateext.root}/${hibernateext.build.script}"/>

		<echo>exec ${build.script} in ${hibernateext.root}/console</echo>
		<exec executable="${build.script}" dir="${hibernateext.root}/console"/>
		<echo>exec ${build.script} in ${hibernateext.root}/tools</echo>
		<exec executable="${build.script}" dir="${hibernateext.root}/tools"/>

		<!-- This part will actually be done in the "pre-build" step of the hibernate-tools plugin customTargets.xml -->
		<!--exec executable="${build.script}" dir="${hibernateext.root}/org.hibernate.eclipse">
			<arg line="-f hibernate-build.xml"/>
			<arg line="update"/>
 </exec-->
 		<echo>${hibernateext.build.dir}</echo>
		<!--propertyregex property="hibernateext.build.dir.escaped"
			input="${hibernateext.build.dir}"
			regexp="\\"
			replace="/"
			casesensitive="false" /-->
 		
 		<echo file="return.properties">
			hibernate.base=${hibernateext.build.dir}/hibernate-3.0
			hibernateext.base=${hibernateext.build.dir}/${hibernateext.cvs.module}
		</echo>
	</target>

	<target name="check.hibernate.downloaded">
		<available file="${hibernateext.build.dir}/${hibernate.release.name}"
			property="hibernate.downloaded"/>
	</target>

	<target name="check.hibernate.unzipped">
		<available file="${hibernateext.build.dir}/hibernate-3.0" type="dir"
			property="hibernate.unzipped"/>
	</target>

	<target name="check.hibernateext.checkedout">
		<available file="${hibernateext.build.dir}/${hibernateext.cvs.module}" type="dir"
			property="hibernateext.checkedout"/>
	</target>

	<target name="download.hibernate" depends="check.hibernate.downloaded" unless="hibernate.downloaded">
		<mkdir dir="${hibernateext.build.dir}"/>
		<get src="${hibernate.release.url}/${hibernate.release.name}" dest="${hibernateext.build.dir}/${hibernate.release.name}"/>

	</target>

	<target name="unzip.hibernate" depends="download.hibernate,check.hibernate.unzipped" unless="hibernate.unzipped">
		<unzip src="${hibernateext.build.dir}/${hibernate.release.name}" dest="${hibernateext.build.dir}"/>
	</target>

	<target name="checkout.hibernateext" depends="check.hibernateext.checkedout" unless="hibernateext.checkedout">
		<cvspass cvsroot="${hibernateext.cvs.root}" password="${hibernateext.cvs.password}"/>

		<for list="${hibernateext.cvs.submodules}" param="submodule">
			<sequential>
				<cvs cvsroot="${hibernateext.cvs.root}" package="${hibernateext.cvs.module}/@{submodule}" tag="${hibernateext.cvs.tag}" dest="${hibernateext.build.dir}" compression="true"/>
			</sequential>
		</for>
	</target>
</project>
