<project>
	
	<!-- just in case we're calling this standalone -->
	<property name="build.root" value="../../.."/>
	
	<loadproperties srcfile="${build.root}/builders/product/build.properties"/>
	
	<macrodef name="load.property">
		<attribute name="file"/>
		<attribute name="property"/>
		<attribute name="dest" default="@{property}"/>
		
		<sequential>
			<loadproperties srcfile="@{file}" >
				<filterchain>
					<linecontains>
						<contains value="@{property}"/>
					</linecontains>
					<replacestring from="@{property}" to="@{dest}"/>
				</filterchain>
			</loadproperties>
		</sequential>
	</macrodef>
	
	<macrodef name="get.version.tag">
		<attribute name="property"/>
		<attribute name="builder"/>
		
		<sequential>
			<if>
				<equals arg1="${product.buildType}" arg2="R"/>
				<then>
					<loadproperties srcfile="versionTags/${product.versionTag}.tags">
						<filterchain>
							<linecontains>
								<contains value="@{builder}"/>
							</linecontains>
							<replacestring from="@{builder}" to="@{property}"/>
						</filterchain>
					</loadproperties>
				</then>
				<else>
					<property name="@{property}" value="${product.versionTag}"/>
				</else>
			</if>
		</sequential>
	</macrodef>
	
	<macrodef name="copyMapFile">
		<attribute name="buildDirectory"/>
		<attribute name="builder"/>
		<attribute name="cvsTag"/>
		
		<sequential>
			<mkdir dir="@{buildDirectory}/maps" />
			<copy todir="@{buildDirectory}/maps">
				<fileset dir="${build.root}/builders/@{builder}">
					<include name="**/*.map"/>
				</fileset>
				<filterset begintoken="%" endtoken="%">
					<filter token="cvsTag" value="@{cvsTag}"/>
				</filterset>
			</copy>
		</sequential>
	</macrodef>
</project>