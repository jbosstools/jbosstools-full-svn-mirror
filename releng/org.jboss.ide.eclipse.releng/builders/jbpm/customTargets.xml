<project name="Build specific targets and properties" default="noDefault" >
	<taskdef name="updateVersions" classname="org.jboss.ide.eclipse.releng.UpdateVersionsTask" classpath="../../bin"/>
	<taskdef classpath="../lib/ant-contrib.jar" resource="net/sf/antcontrib/antlib.xml"/>
	
	<property file="custom.properties" />
	
	<import file="../common/bundlePlugins.xml"/>
	<import file="../common/common.xml"/>
<!-- ===================================================================== -->
<!-- Run a given ${target} on all elements being built -->
<!-- Add on <ant> task for each top level element being built. -->
<!-- ===================================================================== -->
<target name="allElements">
	 <ant antfile="${genericTargets}" target="${target}" >
		<property name="type" value="feature" />
		<property name="id" value="org.jbpm.gd.jpdl.feature" /> 
	</ant>
</target>

<!-- ===================================================================== -->
<!-- Targets to assemble the built elements for particular configurations  -->
<!-- These generally call the generated assemble scripts (named in -->
<!-- ${assembleScriptName}) but may also add pre and post processing -->
<!-- Add one target for each root element and each configuration -->
<!-- ===================================================================== -->

<target name="assemble.org.jbpm.feature">
	<property name="archiveName" value="jBPM-Designer-${versionTag}.zip"/>
	<ant antfile="${assembleScriptName}" dir="${buildDirectory}"/>
</target>

<!-- ===================================================================== -->
<!-- Check out map files from correct repository -->
<!-- Replace values for cvsRoot, package and mapVersionTag as desired. -->
<!-- ===================================================================== -->
<target name="getMapFiles">
	<copyMapFile builder="jbpm" buildDirectory="${buildDirectory}" cvsTag="${cvsTag}"/>
	<replace dir="${buildDirectory}/maps" token="%jbpm-cvs-root%" value="${jbpm-cvs-root}" />
</target>

<!-- ===================================================================== -->
<!-- Steps to do before setup -->
<!-- ===================================================================== -->
<target name="preSetup">
	<echo message="doing preSetup"/>
</target>

<!-- ===================================================================== -->
<!-- Steps to do after setup but before starting the build proper -->
<!-- ===================================================================== -->
<target name="postSetup">
	<echo message="doing postSetup"/>
</target>

<!-- ===================================================================== -->
<!-- Steps to do before fetching the build elements -->
<!-- ===================================================================== -->
<target name="preFetch">
	<echo message="doing preFetch"/>
</target>
	
<!-- ===================================================================== -->
<!-- Steps to do after fetching the build elements -->
<!-- ===================================================================== -->
<target name="postFetch" depends="buildJbpmCoreFiles"> <!--,buildPluginDocs"> -->
<!--
	<property name="jbpm-help-dir" value="${buildDirectory}/plugins/org.jbpm.gd.jpdl.help" />
	<ant antfile="${jbpm-help-dir}/build/build.xml" dir="${jbpm-help-dir}" inheritall="false">
	  	<property name="jbpm.3.dir" value="${jbpm-core-dir}" />
	  	<property name="userguide.dir" value="${jbpm-core-dir}/doc/userguide" />
	  	<property name="jbpm.ide.docs.dir" value="${jbpm.ide.docs.dir}" />
	</ant>
-->
	<replace 
		file="${buildDirectory}/plugins/org.jbpm.ui/src/org/jbpm/ui/PluginConstants.java" 
		token="%jbpm.version%" value="${jbpm.version}" />
	
	<if>
		<not>
			<equals arg1="${buildType}" arg2="R"/>
		</not>
		<then>
			<property name="jbpm-versionTag" value="${jbpm-ide-release}.${versionTag}"/>
		</then>
		<else>
			<property name="jbpm-versionTag" value="${versionTag}"/>
		</else>
	</if>
		
	<updateVersions type="feature" version="${jbpm-versionTag}" append="false"
		updateAssembleScript="false" recursivePlugins="true" failonrecursiveerror="false"
		pluginRegex="org.jbpm.*">
		<fileset dir="${buildDirectory}/features">
			<include name="*jbpm*"/>
		</fileset>
	</updateVersions>
</target>
	
<!--	
<target name="buildPluginDocs" depends="getPluginDocs">
    <ant antfile="build.xml" target="all.doc" dir="${jbpm.ide.docs.dir}/gpd.userguide" inheritall="false" />
</target>
	
<target name="getPluginDocs">
	<property name="jbpm.ide.docs.dir" value="${docbook-support-dir}/../jbpm.ide.docs" />
	<echo message="checking out the plugin docs to ${jbpm.ide.docs.dir}; tag = ${cvsTag}" />
    <mkdir dir="${jbpm.ide.docs.dir}" />

	<cvs cvsRoot="${jbpm-cvs-root}"
		package="jbpm.3/designer/jpdl/docs" tag="${cvsTag}"
		dest="${docbook-support-dir}/.." quiet="${quiet}"/>
	
	<move todir="${jbpm.ide.docs.dir}">
		<fileset dir="${docbook-support-dir}/../jbpm.3/designer/jpdl/docs" includes="**/*"/>
	</move>
			
	<delete dir="${docbook-support-dir}/../jbpm.3"/>
	
</target>
-->
	
<target name="buildJbpmCoreFiles">
	<echo message="building core jbpm plugin"/>
	<echo message="jbpm-core-dir : ${jbpm-core-dir}" />
	<property name="jbpm-core-plugin-dir" value="${buildDirectory}/plugins/org.jbpm.gd.jpdl.core" />
	<echo message="jbpm-core-plugin-dir : ${jbpm-core-plugin-dir}" />
	<copy todir="${jbpm-core-plugin-dir}" includeEmptyDirs="false" >
		<fileset dir="${jbpm-core-dir}" >
			<exclude name="build/**/*.*" />
			<exclude name=".*" />
			<exclude name="build.*" />
		</fileset>
	</copy>	
	<copy todir="${jbpm-core-plugin-dir}">
		<fileset dir="${jbpm-core-dir}" >
			<include name="build/jbpm-3*.jar" />
			<include name="build/jbpm-identity-3*.jar" />
		</fileset>
	</copy>
</target>
	
<!-- ===================================================================== -->
<!-- Steps to do before generating the build scripts. -->
<!-- ===================================================================== -->
<target name="preGenerate">
	<echo message="doing preGenerate"/>
</target>

<!-- ===================================================================== -->
<!-- Steps to do after generating the build scripts. -->
<!-- ===================================================================== -->
<target name="postGenerate">
	<echo message="doing postGenerate"/>
</target>


<!-- ===================================================================== -->
<!-- Steps to do before running the build.xmls for the elements being built. -->
<!-- ===================================================================== -->
<target name="preProcess">
	<echo message="doing preProcess"/>
</target>

<!-- ===================================================================== -->
<!-- Steps to do after running the build.xmls for the elements being built. -->
<!-- ===================================================================== -->
<target name="postProcess">
	<echo message="doing postProcess"/>
</target>


<!-- ===================================================================== -->
<!-- Steps to do before running assemble. -->
<!-- ===================================================================== -->
<target name="preAssemble">
	<echo message="doing preAssemble"/>
</target>

<!-- ===================================================================== -->
<!-- Steps to do after  running assemble. -->
<!-- ===================================================================== -->
<target name="postAssemble">
	<echo message="doing postAssemble"/>
	
	<bundlePlugins pluginList="${include.plugins}" buildDirectory="${buildDirectory}"
			archivePath="${buildDirectory}/${buildLabel}/jBPM-Designer-${versionTag}.zip" />
	
</target>

<!-- ===================================================================== -->
<!-- Steps to do after the build is done. -->
<!-- ===================================================================== -->
<target name="postBuild">
</target>

<!-- ===================================================================== -->
<!-- Steps to do to test the build results -->
<!-- ===================================================================== -->
<target name="test">
	<echo message="doing test"/>
</target>

<!-- ===================================================================== -->
<!-- Steps to do to publish the build results -->
<!-- ===================================================================== -->
<target name="publish">
	<echo message="doing publish"/>
</target>

<!-- ===================================================================== -->
<!-- Default target                                                        -->
<!-- ===================================================================== -->
<target name="noDefault">
	<echo message="You must specify a target when invoking this file" />
</target>

</project>
