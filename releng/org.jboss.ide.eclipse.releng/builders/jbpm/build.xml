<?xml version="1.0" encoding="UTF-8"?>
<project name="org.jbpm" default="all" basedir=".">
	
	<target name="init">
		<property file="${user.home}/jbpm/build/build.properties" />
		<property file="custom.properties" />
		<property name="jbpm-cvs-root" value=":pserver:anonymous@cvs.sourceforge.net:/cvsroot/jbpm" />
		<property name="docbook-download-dir" value="${download-dir}/docbook-support" />
		<property name="jbpm-core-download-dir" value="${download-dir}/${jbpm-core-module}.${jbpm-core-version-tag}" />
		<property name="jbpm-db-download-dir" value="${download-dir}/${jbpm-db-module}.${jbpm-db-version-tag}" />
		<mkdir dir="${download-dir}" />
		<mkdir dir="${install-dir}" />
		<mkdir dir="${workspace-dir}" />
	</target>
	
	<target name="clean" depends="init">
		<delete dir="${workspace-dir}" />
	</target>
	
	<target name="download-platform" depends="init">
		<get src="${eclipse-url}" 
		    dest="${download-dir}/${eclipse-file-name}" 
		    usetimestamp="true"
		    verbose="on"/>
		<get src="${webtools-url}" 
		    dest="${download-dir}/${webtools-file-name}" 
		    usetimestamp="true"
		    verbose="on"/>		
		<get src="${emf-url}" 
		    dest="${download-dir}/${emf-file-name}" 
		    usetimestamp="true"
		    verbose="on"/>		
		<get src="${gef-url}" 
		    dest="${download-dir}/${gef-file-name}" 
		    usetimestamp="true"
		    verbose="on"/>		
		<get src="${jem-url}" 
		    dest="${download-dir}/${jem-file-name}" 
		    usetimestamp="true"
		    verbose="on"/>	
	</target>
	
	<target name="install-platform" depends="download-platform">
		<unzip src="${download-dir}/${eclipse-file-name}" dest="${install-dir}" overwrite="false"/>
		<unzip src="${download-dir}/${webtools-file-name}" dest="${install-dir}" overwrite="false"/>
		<unzip src="${download-dir}/${emf-file-name}" dest="${install-dir}" overwrite="false"/>
		<unzip src="${download-dir}/${gef-file-name}" dest="${install-dir}" overwrite="false"/>
		<unzip src="${download-dir}/${jem-file-name}" dest="${install-dir}" overwrite="false"/>
	</target>
	
	<target name="get-docbook" depends="fetch-condition" unless="docbook-available">
		<cvs 
			cvsRoot=":pserver:anonymous@anoncvs.forge.jboss.com:/cvsroot/jboss" 
			command="export -d ${docbook-download-dir} -r HEAD docbook-support" />
	</target>
		
	<target name="get-jbpm-core" depends="fetch-condition" unless="jbpm-core-available">
		<cvs 
			cvsRoot=":pserver:anonymous@cvs.sourceforge.net:/cvsroot/jbpm" 
			command="export -d ${jbpm-core-download-dir} -r ${jbpm-core-version-tag} ${jbpm-core-module}" 
			quiet="${quiet}" />
	</target>
		
	<target name="get-jbpm-db" depends="fetch-condition" unless="jbpm-db-available">
		<cvs 
			cvsRoot=":pserver:anonymous@cvs.sourceforge.net:/cvsroot/jbpm" 
			command="export -d ${jbpm-db-download-dir} -r ${jbpm-db-version-tag} ${jbpm-db-module}" 
			quiet="${quiet}" />
	</target>
		
	<target name="fetch-condition" depends="init">
		<available file="${docbook-download-dir}" property="docbook-available" />
		<available file="${jbpm-core-download-dir}" property="jbpm-core-available" />
		<available file="${jbpm-db-download-dir}" property="jbpm-db-available" />
	</target>

	<target name="launch-builder" depends="clean,install-platform,get-docbook,get-jbpm-core,get-jbpm-db">
		<java classname="org.eclipse.core.launcher.Main" fork="true">
			<classpath path="${install-dir}/eclipse/startup.jar" />
			<arg line="-application org.eclipse.ant.core.antRunner" />
			<arg line="-data ${workspace-dir}"/>
			<arg line="-f mainTargets.xml"/>
			<arg line="-Djbpm-cvs-root=${jbpm-cvs-root}" />
		</java>
	</target>
		
	<target name="all" depends="launch-builder" />

</project>
