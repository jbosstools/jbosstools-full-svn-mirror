<project default="build.results">

	<import file="../common/scp.xml"/>
	<import file="../common/common.xml"/>
		
	<target name="get.build.properties">
		<load.property file="../../requirements/eclipse/build.properties" property="eclipseBuildID"/>
		<load.property file="../../requirements/eclipse/build.properties" property="eclipseURL"/>
		<property name="eclipse.download.url" value="${eclipseURL}/eclipse-SDK-${eclipseBuildID}-win32.zip"/>
		
		<load.property file="../../requirements/emf-sdo-xsd/build.properties" property="build.uri" dest="emf.sdo.xsd.build.uri"/>
		<load.property file="../../requirements/emf-sdo-xsd/build.properties" property="build.archive" dest="emf.sdo.xsd.build.archive"/>
		<load.property file="../../requirements/gef/build.properties" property="build.uri" dest="gef.build.uri"/>
		<load.property file="../../requirements/gef/build.properties" property="build.archive" dest="gef.build.archive"/>
		<load.property file="../../requirements/jem/build.properties" property="build.uri" dest="jem.build.uri"/>
		<load.property file="../../requirements/jem/build.properties" property="build.archive" dest="jem.build.archive"/>
		<load.property file="../../requirements/webtools/build.properties" property="build.uri" dest="webtools.build.uri"/>
		<load.property file="../../requirements/webtools/build.properties" property="build.archive" dest="webtools.build.archive"/>

		<get.version.tag builder="aop" property="aop.versionTag"/>
		<get.version.tag builder="ejb3" property="ejb3.versionTag"/>
		<get.version.tag builder="core" property="core.versionTag"/>
		<load.property file="../hibernate-tools/build.properties" property="hibernate.tools.release"/>
		<get.version.tag builder="hibernate-tools" property="hibernate-tools.versionTag"/>
		<get.version.tag builder="jbpm" property="jbpm.versionTag"/>
		
		<loadfile property="build.information" srcfile="buildInfo/${product.buildDesc}.html"/>
	</target>
		
	<target name="build.results" depends="get.build.properties">
		<tstamp>
			<format property="date" pattern="MMMM d yyyy"/>
		</tstamp>
		
		<copy todir="${product.build.directory}" overwrite="true">
			<fileset file="buildResults.html.template"/>
			<mapper type="glob" from="*.html.template" to="*.html"/>
			<filterset begintoken="%" endtoken="%">
				<filter token="build-type" value="${product.buildDesc}"/>
				<filter token="jbosside-build-name" value="${product.versionTag}"/>
				<filter token="jbosside-download-root" value="${jbosside.download.root}"/>
				<filter token="date" value="${date}"/>
				
				<filter token="eclipse-download-url" value="${eclipse.download.url}"/>
				<filter token="eclipse-target" value="eclipse-SDK-${eclipseBuildID}-win32.zip"/>
				<filter token="webtools-download-url" value="${webtools.build.uri}/${webtools.build.archive}"/>
				<filter token="webtools-target" value="${webtools.build.archive}"/>
				<filter token="gef-download-url" value="${gef.build.uri}/${gef.build.archive}"/>
				<filter token="gef-target" value="${gef.build.archive}"/>
				<filter token="emf-sdo-xsd-download-url" value="${emf.sdo.xsd.build.uri}/${emf.sdo.xsd.build.archive}"/>
				<filter token="emf-sdo-xsd-target" value="${emf.sdo.xsd.build.archive}"/>
				<filter token="jem-download-url" value="${jem.build.uri}/${jem.build.archive}"/>
				<filter token="jem-target" value="${jem.build.archive}"/>
				
				<filter token="jbosside-all-filename" value="${product.name}-${product.versionTag}-ALL.zip"/>
				<filter token="jbosside-win32-bundle-filename" value="${product.name}-${product.versionTag}-Bundle-win32.zip"/>
				<filter token="jbosside-linux-gtk2-bundle-filename" value="${product.name}-${product.versionTag}-Bundle-linux-gtk.tar.gz"/>
				<filter token="jbosside-core-filename" value="JBossIDE-CORE-${core.versionTag}.zip"/>
				<filter token="jbosside-aop-filename" value="JBossIDE-AOP-Developer-${aop.versionTag}.zip"/>
				<filter token="jbosside-hibernate-tools-filename" value="HibernateTools-${hibernate.tools.release}.${hibernate-tools.versionTag}.zip"/>
				<filter token="jbosside-jbpm-filename" value="jBPM-Designer-${jbpm.versionTag}.zip"/>
				<filter token="jbosside-ejb3-filename" value="JBossIDE-EJB3-Tools-${ejb3.versionTag}.zip"/>
				<filter token="build-information" value="${build.information}"/>
			</filterset>
		</copy>
		
		<!--echo file="${product.build.root}/log.properties">
			upload.to=${product.buildDesc}/${product.versionTag}
			build.dir=${product.build.directory}
		</echo-->
	</target>
	
	<property file="../global.properties"/>
	<property file="build.properties"/>
	
	<target name="publish.log" if="enable.publishing">

		<property file="${product.build.root}/log.properties"/>
			
		<zip destfile="${product.build.directory}/build.log.zip">
			<fileset file="${build.root}/builders/build.log"/>
		</zip>
		<delete>
			<fileset file="${build.root}/builders/build.log"/>
		</delete>
		
		<scp.fileset.trusted todir="${upload.to}">
			<fileset file="${product.build.directory}/build.log.zip"/>
			<fileset file="${product.build.directory}/buildResults.html"/>
		</scp.fileset.trusted>
			
		<!--scp trust="true" todir="${ssh.username}@${ssh.host}:${scp.basedir}/${upload.to}" keyfile="${ssh.key}" passphrase="${ssh.passphrase}">
			<fileset file="${build.dir}/build.log.zip"/>
		</scp-->
	</target>
</project>