<project default="customize.interactive">

	<taskdef classpath="lib/ant-contrib.jar" resource="net/sf/antcontrib/antlib.xml"/>
	
	<target name="customize">
		<property file="customize.properties"/>
		
		<if>
			<equals arg1="${enable.publishing}" arg2="false"/>
			<then>
				<property name="comment.enable.publishing" value="#"/>
			</then>
			<else>
				<property name="comment.enable.publishing" value=""/>
			</else>
		</if>
		
		<if>
			<equals arg1="${enable.notification}" arg2="false"/>
			<then>
				<property name="comment.enable.notification" value="#"/>
			</then>
			<else>
				<property name="comment.enable.notification" value=""/>
			</else>
		</if>
					
		<copy todir="builders" overwrite="true">
			<fileset dir="builders">
				<include name="**/*.properties.template"/>
			</fileset>
			<mapper type="glob" from="*.properties.template" to="*.properties"/>
			<filterset begintoken="%" endtoken="%">
				<filter token="eclipse-archive-path" value="${eclipse.archive.path}"/>
				<filter token="ssh-key" value="${ssh.key}"/>
				<filter token="ssh-passphrase" value="${ssh.passphrase}"/>
				<filter token="build-output-directory" value="${build.output.directory}"/>
				<filter token="clean-eclipse-home" value="${clean.eclipse.home}"/>
				<filter token="releng-root" value="${releng.root}"/>
				
				<filter token="comment-enable-publishing" value="${comment.enable.publishing}"/>
				<filter token="enable-publishing" value="${enable.publishing}"/>
				<filter token="comment-enable-notification" value="${comment.enable.notification}"/>
				<filter token="enable-notification" value="${enable.notification}"/>
				<filter token="build-script-ext" value="${build.script.ext}"/>
			</filterset>
		</copy>
		
		<mkdir dir="bin"/>
		<javac destdir="bin" srcdir="src">
			<classpath>
				<fileset dir="lib">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
		</javac>
		
		<!-- this will copy all property and xml files over to the bin folder -->
		<copy todir="bin">
			<fileset dir="src">
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
	</target>
	
	<target name="customize.interactive">
	    <taskdef name="Cheese" classname="org.jboss.cheese.CheeseTask" classpath="lib/jboss-cheese.jar"/>

		<Cheese>
			<Questions>
				<DialogDescription>
					JBossIDE Releng Customization
				</DialogDescription>
				
				<fileSelectionQuestion type="directory" label="Location of eclipse zip binaries" propertyName="eclipse.archive.path" default="C:\Downloads"/>
				<fileSelectionQuestion type="directory" label="Location for build binaries" propertyName="build.output.directory" default="C:\jbosside-build"/>
				<fileSelectionQuestion type="directory" label="Location of a clean eclipse 3.1 installation (no external plugins)" propertyName="clean.eclipse.home"/>
				<fileSelectionQuestion type="directory" label="Location of JBossIDE Releng Project Root" propertyName="releng.root" default="${basedir}"/>

				<fileSelectionQuestion type="none" label="Location of SSH Private Key" propertyName="ssh.key"/>
				<textQuestion label="SSH Passphrase" propertyName="ssh.passphrase" />
				
				<booleanQuestion label="Enable SCP Publishing?" propertyName="enable.publishing" default="false"/>
				<booleanQuestion label="Enable Email Notification?" propertyName="enable.notification" default="false"/>
			</Questions>
		</Cheese>
		
		<condition property="build.script.ext" value="sh" else="bat" >
			<os family="unix"/>
		</condition>
		
		<antcall target="customize" inheritall="true"/>
	</target>
	
</project>