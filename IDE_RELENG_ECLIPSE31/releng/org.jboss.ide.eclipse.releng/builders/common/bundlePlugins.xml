<project>
	<taskdef classpath="${build.root}/lib/ant-contrib.jar" resource="net/sf/antcontrib/antlib.xml"/>
	
	<macrodef name="bundlePlugins">
		<attribute name="pluginList"/>
		<attribute name="archivePath"/>
		<attribute name="buildDirectory"/>

		<sequential>
			<property name="plugins.dir" value="@{buildDirectory}/plugins"/>
			<property name="tmp.dir" value="${java.io.tmpdir}/jbosside-build"/>

			<mkdir dir="${tmp.dir}/plugins" />
				
			<for list="@{pluginList}"  param="plugin.name" trim="true">
				<sequential>
					<copy todir="${tmp.dir}/plugins">
						<fileset dir="${plugins.dir}">
							<include name="@{plugin.name}_*/**/*.*" />
							<include name="@{plugin.name}_*.jar"/>
						</fileset>
					</copy>
				</sequential>
			</for>
			
			<zip destfile="@{archivePath}" basedir="${tmp.dir}" update="yes"/>
			<delete dir="${tmp.dir}"/>
		</sequential>
	</macrodef>

</project>