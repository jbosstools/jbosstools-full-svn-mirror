<project>
	
	<!-- just in case we're calling this standalone -->
	<property name="build.root" value="../.."/>
	
	<loadproperties srcfile="${build.root}/builders/product/build.properties"/>
	<taskdef classpath="${build.root}/lib/ant-contrib.jar" resource="net/sf/antcontrib/antlib.xml"/>
	
	<macrodef name="buildRequirements">
		<attribute name="requirements"/>
		
		<sequential>
		<for list="@{requirements}" param="requirement">
			<sequential>
				<if>
					<not>
						<available file="${requirement.root}/@{requirement}/return.properties" />
					</not>
					<then>
						<echo>${requirement.root}/@{requirement}/return.properties is not available</echo>
						<ant dir="${requirement.root}/@{requirement}" antfile="buildRequirement.xml" target="build.requirement" inheritAll="true" />
						<if>
							<available file="${requirement.root}/@{requirement}/return.properties" />
							<then>
								<echo>load properties from ${requirement.root}/@{requirement}/return.properties</echo>
								<loadproperties srcFile="${requirement.root}/@{requirement}/return.properties" />
							</then>
						</if>
					</then>
					<else>
						<echo>load properties from ${requirement.root}/@{requirement}/return.properties</echo>
						<loadproperties srcFile="${requirement.root}/@{requirement}/return.properties" />
					</else>
				</if>
			</sequential>
		</for>
		</sequential>
	</macrodef>
	
	<target name="cleanRequirements">
		<delete failonerror="false" includeemptydirs="true">
			<fileset dir="${requirement.root}" defaultexcludes="false">
				  <include name="**/return.properties"/>	
			</fileset>
		</delete>
	</target>
</project>