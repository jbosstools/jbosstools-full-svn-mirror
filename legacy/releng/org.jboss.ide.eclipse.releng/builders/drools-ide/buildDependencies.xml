<project default="build" xmlns:artifact="urn:maven-artifact-ant">

	<property file="build.properties"/>

	<target name="init-maven">
		<path id="maven.classpath">
			<pathelement location="../../lib/maven-artifact-ant-2.0.4-dep.jar" />
		</path>

		<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
			<classpath refid="maven.classpath"/>
		</typedef>
	</target>

	<target name="generate-pom">
	<echo file="pom.xml"><![CDATA[
		<project>
			<modelVersion>4.0.0</modelVersion>
			<groupId>org.drools</groupId>
			<artifactId>drools-ide</artifactId>
			<packaging>pom</packaging>
			<name>DroolsIDE</name>
			<version>${drools.version}</version>

			<repositories>
				<repository>
					<id>ibiblio.repository</id>
					<url>http://www.ibiblio.org/maven2/</url>
				</repository>
				<repository>
					<id>jboss.repository</id>
					<url>http://repository.jboss.com/maven2</url>
				</repository>
				</repositories>

			<dependencies>
				<dependency>
					<groupId>org.drools</groupId>
					<artifactId>drools-decisiontables</artifactId>
					<version>${drools.version}</version>
				</dependency>
				<dependency>
					<groupId>org.drools</groupId>
					<artifactId>drools-jsr94</artifactId>
					<version>${drools.version}</version>
				</dependency>
			</dependencies>
		</project>
	]]></echo>
	</target>

	<target name="build" depends="init-maven,generate-pom">
		<artifact:dependencies filesetId="drools-ide.dependency.fileset" verbose="false">
			<pom file="pom.xml"/>
		</artifact:dependencies>

      <copy todir="repository">
        <fileset refid="drools-ide.dependency.fileset"/>
      </copy>   

	<property name="drools-ide.lib.dir" value="${buildDirectory}/plugins/org.drools.ide/lib" />

      <copy todir="${drools-ide.lib.dir}"            
            flatten="true">
        <fileset dir="repository" includes="**/*.jar" excludes="**/jsr94-sigtest-1.1.jar **/jsr94-tck-1.0.3.jar **/core-*.jar "/>
      </copy>

		<move tofile="${drools-ide.lib.dir}/drools-core.jar" flatten="true" file="${drools-ide.lib.dir}/drools-core-${drools.version}.jar" />
		<move tofile="${drools-ide.lib.dir}/drools-compiler.jar" flatten="true" file="${drools-ide.lib.dir}/drools-compiler-${drools.version}.jar" />
		<move tofile="${drools-ide.lib.dir}/drools-decisiontables.jar" flatten="true" file="${drools-ide.lib.dir}/drools-decisiontables-${drools.version}.jar" />
		<move tofile="${drools-ide.lib.dir}/drools-jsr94.jar" flatten="true" file="${drools-ide.lib.dir}/drools-jsr94-${drools.version}.jar" />
	</target>
</project>
