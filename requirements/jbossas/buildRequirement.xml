<project default="build.requirement">
	<property file="build.properties" />

	<target name="build-jbossas">
		<ant antfile="../generic/build.xml" target="${action}" inheritall="true">
			<property name="requirement" value="jbossas" />
		</ant>
	</target>

	<target name="build.requirement">
		<antcall target="build-all">
			<param name="action" value="build.requirement" />
		</antcall>
	</target>

	<target name="download.requirement">
		<antcall target="build-all">
			<param name="action" value="download.requirement" />
		</antcall>
	</target>

	<target name="build-all">
		<antcall target="build-jbossas">
			<param name="build.uri" value="${jboss32.build.uri}" />
			<param name="build.archive" value="${jboss32.build.archive}" />
			<param name="md5" value="${jboss32.build.archive.md5}" />
		</antcall>
		<antcall target="build-jbossas">
			<param name="build.uri" value="${jboss40.build.uri}" />
			<param name="build.archive" value="${jboss40.build.archive}" />
			<param name="md5" value="${jboss40.build.archive.md5}" />
		</antcall>
		<antcall target="build-jbossas">
			<param name="build.uri" value="${jboss42.build.uri}" />
			<param name="build.archive" value="${jboss42.build.archive}" />
			<param name="md5" value="${jboss42.build.archive.md5}" />
		</antcall>
		<antcall target="build-jbossas">
			<param name="build.uri" value="${jboss50.build.uri}" />
			<param name="build.archive" value="${jboss50.build.archive}" />
			<param name="md5" value="${jboss50.build.archive.md5}" />
		</antcall>
		<antcall target="build-jbossas">
			<param name="build.uri" value="${jboss51.build.uri}" />
			<param name="build.archive" value="${jboss51.build.archive}" />
			<param name="md5" value="${jboss51.build.archive.md5}" />
		</antcall>

		<antcall target="build-jbossas">
			<param name="build.uri" value="${jboss60.build.uri}" />
			<param name="build.archive" value="${jboss60.build.archive}" />
			<param name="md5" value="${jboss60.build.archive.md5}" />
		</antcall>

<!-- this is called via the requirements profile in ../../build/parent/pom.xml, which sets these properties:
		<requirements.root>${basedir}/../../../requirements</requirements.root>
		<requirement.build.root>${requirements.root}/target</requirement.build.root>
-->
		<echo>${ant.file}, ${basedir}, ${unzip.dest}, ${requirement.build.root}</echo>

		<!-- rename target folder from 6.0.0.Final to 6.0.0 -->
		
		<for param="dir">
			<path>
				<fileset dir="${requirement.build.root}/" includes="jboss-6.0.0*" />
			</path>
			<sequential>
				<rename src="@{dir}" dest="${requirement.build.root}/jboss-6.0.0" />
			</sequential>
		</for>

		<antcall target="build-jbossas">
			<param name="build.uri" value="${jboss70.build.uri}" />
			<param name="build.archive" value="${jboss70.build.archive}" />
			<param name="md5" value="${jboss70.build.archive.md5}" />
		</antcall>
		<!-- rename target folder from 7.0.0.Beta3 to 7.0.0 -->
		<for param="dir">
			<path>
				<fileset dir="${requirement.build.root}/" includes="jboss-7.0.0*" />
			</path>
			<sequential>
				<rename src="${requirement.build.root}/jboss-7.0.0.Beta3" dest="${requirement.build.root}/jboss-7.0.0" />
			</sequential>
		</for>
	</target>
</project>
