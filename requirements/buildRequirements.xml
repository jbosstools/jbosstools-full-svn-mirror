<project>

	<!-- just in case we're calling this standalone -->
	<property name="build.root" value="${basedir}" />

	<taskdef classpath="${basedir}/lib/ant-contrib.jar" resource="net/sf/antcontrib/antlib.xml" />

	<macrodef name="buildRequirements">
		<attribute name="requirements" />
		<attribute name="unzipto" />

		<sequential>
			<for list="@{requirements}" param="requirement">
				<sequential>
					<if>
						<not>
							<available file="${requirement.root}/@{requirement}/return.properties" />
						</not>
						<then>
							<echo>${requirement.root}/@{requirement}/return.properties is not available</echo>
							<unpackRequirement requirement="@{requirement}" unpackto="@{unzipto}" />
						</then>
					</if>
					<if>
						<available file="${requirement.root}/@{requirement}/return.properties" />
						<then>
							<echo>load properties from ${requirement.root}/@{requirement}/return.properties</echo>
							<loadproperties srcFile="${requirement.root}/@{requirement}/return.properties" />
						</then>
					</if>
				</sequential>
			</for>
		</sequential>
	</macrodef>

	<macrodef name="unpackRequirements">
		<attribute name="requirements" />
		<attribute name="unzipto" />
		<sequential>
			<for list="@{requirements}" param="requirement">
				<sequential>
					<if>
						<available file="${requirement.root}/@{requirement}/buildRequirement.xml" />
						<then>
							<ant dir="${requirement.root}/@{requirement}"
								antfile="buildRequirement.xml"
								target="build.requirement"
								inheritAll="true"
							>
								<property name="unzip.dest" value="@{unzipto}" />
								<property name="requirement.name" value="@{requirement}" />
							</ant>
						</then>
						<else>
							<ant dir="${requirement.root}/@{requirement}"
								antfile="${requirement.root}/generic/build.xml"
								target="build.requirement"
								inheritAll="true"
							>
								<property name="unzip.dest" value="@{unzipto}" />
								<property name="requirement" value="@{requirement}" />
							</ant>
						</else>
					</if>
					<echo>load properties from ${requirement.root}/@{requirement}/return.properties</echo>
					<loadproperties srcFile="${requirement.root}/@{requirement}/return.properties" />
				</sequential>
			</for>
		</sequential>
	</macrodef>

	<macrodef name="downloadRequirement">
		<attribute name="requirement" />
		<sequential>
			<if>
				<available file="${requirement.root}/@{requirement}/buildRequirement.xml" />
				<then>
					<var name="requirement.build.xml" value="buildRequirement.xml" />
				</then>
				<else>
					<var name="requirement.build.xml" value="${requirement.root}/generic/build.xml" />
				</else>
			</if>
			<ant dir="${requirement.root}/@{requirement}"
			     antfile="${requirement.build.xml}"
			     target="download.requirement"
			     inheritAll="true"
			>
				<property name="requirement.name" value="@{requirement}" />
			</ant>
		</sequential>
	</macrodef>

	<macrodef name="unpackRequirement">
		<attribute name="requirement" />
		<attribute name="unpackto" />
		<sequential>
			<if>
				<available file="${requirement.root}/@{requirement}/buildRequirement.xml" />
				<then>
					<var name="requirement.build.xml" value="buildRequirement.xml" />
				</then>
				<else>
					<var name="requirement.build.xml" value="${requirement.root}/generic/build.xml" />
				</else>
			</if>
			<ant dir="${requirement.root}/@{requirement}"
			     antfile="${requirement.build.xml}"
			     target="build.requirement"
			     inheritAll="true"
			>
				<property name="unzip.dest" value="@{unpackto}" />
				<property name="requirement.name" value="@{requirement}" />
			</ant>
		</sequential>
	</macrodef>

	<macrodef name="downloadRequirements">
		<attribute name="requirements" />
		<sequential>
			<for list="@{requirements}" param="requirement">
				<sequential>
					<downloadRequirement requirement="@{requirement}" />
				</sequential>
			</for>
		</sequential>
	</macrodef>

	<!--target name="downloadRequirements">
		<sequential>
			<for list="${requirements}" param="requirement">
				<sequential>
					<echo>${requirement.root}/@{requirement}/return.properties is not available</echo>
					<ant dir="${requirement.root}/@{requirement}"
					     antfile="buildRequirement.xml"
					     target="download.requirement"
						 inheritAll="true">
					</ant>
				</sequential>
			</for>
		</sequential>
	</target-->

</project>